# 离职年假计算器 - 打包说明

## 🎯 概述

本文档说明如何将离职年假计算器打包成独立的可执行文件（exe/app），方便在没有Python环境的计算机上运行。

## 📋 打包前准备

### 1. 环境要求
- **Python版本**: 3.8 或更高版本
- **操作系统**: Windows 10+, macOS 10.13+, Ubuntu 18.04+
- **内存**: 至少 2GB 可用内存
- **磁盘空间**: 至少 500MB 可用空间

### 2. 依赖检查
确保已安装所有必要依赖：
```bash
pip install -r requirements.txt
```

### 3. 配置文件
确保 `.env.template` 文件存在，打包后用户可以复制为 `.env` 进行配置。

## 🚀 一键打包方法

### 方法一：使用自动化脚本（推荐）

#### Windows用户
双击运行 `build.bat` 文件，或在命令行中执行：
```cmd
build.bat
```

#### macOS/Linux用户
在终端中执行：
```bash
./build.sh
```
或者：
```bash
bash build.sh
```

### 方法二：使用Python脚本
```bash
python build.py
```

### 方法三：手动使用PyInstaller
```bash
# 安装PyInstaller
pip install pyinstaller

# 使用spec文件打包
pyinstaller build.spec
```

## 📁 输出结构

打包完成后，会生成以下目录结构：

```
项目根目录/
├── dist/                    # PyInstaller输出目录
│   └── 离职年假计算器.exe    # Windows可执行文件
│   └── 离职年假计算器.app    # macOS应用包
├── release/                 # 发布包目录
│   ├── 离职年假计算器.exe    # 可执行文件
│   ├── README.md           # 使用说明
│   ├── .env.template       # 配置模板
│   └── docs/               # 文档目录
└── build/                  # 构建临时文件（可删除）
```

## 🔧 打包配置说明

### build.spec 文件配置

- **入口文件**: `main.py`
- **包含数据**: 配置模板、文档文件
- **隐藏导入**: 自动包含所有必要的Python模块
- **排除模块**: 排除不必要的大型库（如numpy、matplotlib等）
- **压缩**: 启用UPX压缩（如果可用）
- **控制台**: 设置为GUI模式（不显示控制台窗口）

### 关键配置项

```python
# 数据文件
datas = [
    ('.env.template', '.'),
    ('docs', 'docs'),
    ('README.md', '.'),
]

# 隐藏导入（解决动态导入问题）
hiddenimports = [
    'tkinter', 'requests', 'dotenv', 'tkcalendar'
]

# 排除模块（减小体积）
excludes = [
    'matplotlib', 'numpy', 'pandas', 'scipy'
]
```

## 📊 打包结果

### 预期文件大小
- **Windows exe**: 约 15-25 MB
- **macOS app**: 约 20-30 MB
- **Linux**: 约 15-25 MB

### 包含组件
- ✅ Python解释器
- ✅ 所有项目代码
- ✅ 第三方依赖库
- ✅ 配置文件模板
- ✅ 文档文件

## 🐛 常见问题

### 1. 打包失败
**问题**: PyInstaller报错或打包中断
**解决方案**:
```bash
# 清理缓存
pip cache purge
# 重新安装PyInstaller
pip uninstall pyinstaller
pip install pyinstaller
# 重新打包
python build.py
```

### 2. 可执行文件过大
**问题**: 生成的exe文件超过50MB
**解决方案**:
- 检查是否包含了不必要的库
- 在 `build.spec` 中添加更多排除项
- 启用UPX压缩

### 3. 运行时缺少模块
**问题**: 打包后运行报"ModuleNotFoundError"
**解决方案**:
- 在 `build.spec` 的 `hiddenimports` 中添加缺少的模块
- 重新打包

### 4. GUI界面异常
**问题**: 界面显示不正常或崩溃
**解决方案**:
- 确保tkinter相关模块都已包含
- 检查 `console=False` 设置
- 测试在不同分辨率下的显示效果

## 🔍 测试建议

### 打包后测试清单
- [ ] 在干净的系统上测试运行
- [ ] 测试所有GUI功能
- [ ] 测试企业微信API连接
- [ ] 测试配置文件读取
- [ ] 测试日志文件生成
- [ ] 测试错误处理机制

### 兼容性测试
- [ ] Windows 10/11
- [ ] macOS 10.15+
- [ ] 不同屏幕分辨率
- [ ] 不同DPI设置

## 📦 发布准备

### 发布包内容
```
离职年假计算器_v1.0/
├── 离职年假计算器.exe      # 主程序
├── README.md             # 使用说明
├── .env.template         # 配置模板
├── 使用手册.pdf           # 详细手册（可选）
└── docs/                # 技术文档
    ├── 安装说明.md
    ├── 配置指南.md
    └── 故障排除.md
```

### 版本信息
- **版本号**: 1.0.0
- **构建日期**: 自动生成
- **支持系统**: Windows 10+, macOS 10.13+
- **Python版本**: 3.8+

## 🎉 完成

打包完成后，用户只需要：
1. 下载发布包
2. 解压到任意目录
3. 复制 `.env.template` 为 `.env` 并配置
4. 双击运行 `离职年假计算器.exe`

无需安装Python环境，即可直接使用！

---

**作者**: 斯格拉奇 (Skrachy) 🐔🤖  
**版本**: 1.0.0  
**更新日期**: 2025-01-08